# Shop 店鋪系統

## 模組資訊

| 項目 | 說明 |
|------|------|
| 模組名稱 | Shop |
| 開發階段 | Phase 2 |
| 複雜度 | 中 |
| 相依模組 | Auth, Member |
| 被依賴 | Point |

---

## 功能概述

店鋪系統管理商務會員的店鋪資訊，提供公益商家列表展示、店鋪詳情、地圖定位等功能。

---

## 功能清單

### 後台功能

| 功能 | 說明 |
|------|------|
| 店鋪列表 | 查看所有店鋪列表 |
| 店鋪詳情 | 查看店鋪完整資訊 |
| 店鋪搜尋 | 搜尋店鋪（名稱、類別、商會） |

### 客端功能

| 功能 | 說明 |
|------|------|
| 公益商家列表 | 顯示公益商家列表（來自商務會員店鋪） |
| 分類篩選 | 食/衣/住/行/育樂/大健康/其他 |
| 商家搜尋 | 搜尋商家 |
| 商家詳情 | 查看商家完整資訊 |
| 地圖定位 | 顯示商家位置、可導航 |
| 我的店鋪 | 編輯自己的店鋪資訊 |

---

## API 端點設計

### 後台 API

| 方法 | 端點 | 說明 |
|------|------|------|
| GET | /api/v1/admin/shops | 店鋪列表 |
| GET | /api/v1/admin/shops/:id | 店鋪詳情 |
| PUT | /api/v1/admin/shops/:id/status | 更新店鋪狀態 |

### 客端 API

**公益商家**

| 方法 | 端點 | 說明 |
|------|------|------|
| GET | /api/v1/shops | 公益商家列表 |
| GET | /api/v1/shops/:id | 商家詳情 |
| GET | /api/v1/shops/categories | 商家分類列表 |
| GET | /api/v1/shops/nearby | 附近商家 |

**我的店鋪**

| 方法 | 端點 | 說明 |
|------|------|------|
| GET | /api/v1/shops/mine | 取得我的店鋪 |
| POST | /api/v1/shops/mine | 建立店鋪 |
| PUT | /api/v1/shops/mine | 更新店鋪 |
| PUT | /api/v1/shops/mine/images | 更新店鋪圖片 |

---

## 資料庫設計

### 店鋪表

| 欄位 | 類型 | 說明 |
|------|------|------|
| id | UUID | 主鍵 |
| memberId | 字串 | 店鋪擁有者（唯一） |
| name | 字串 | 店鋪名稱 |
| categoryId | 字串 | 分類 ID |
| slogan | 字串 | 宣傳標語（選填） |
| description | 長文字 | 店鋪介紹（選填） |
| phone | 字串 | 聯絡電話（選填） |
| email | 字串 | 聯絡郵箱（選填） |
| address | 字串 | 完整地址（選填） |
| city | 字串 | 城市（選填） |
| district | 字串 | 區域（選填） |
| latitude | 浮點數 | 緯度（選填） |
| longitude | 浮點數 | 經度（選填） |
| businessHours | JSON | 營業時間（選填） |
| discount | 長文字 | 優惠政策（選填） |
| coverImage | 字串 | 封面圖片（選填） |
| images | 字串陣列 | 店鋪圖片 |
| isActive | 布林 | 是否啟用（預設 true） |
| isPublic | 布林 | 是否公開顯示（預設 true） |
| viewCount | 整數 | 瀏覽次數（預設 0） |
| createdAt | 時間 | 建立時間 |
| updatedAt | 時間 | 更新時間 |

### 店鋪分類表

| 欄位 | 類型 | 說明 |
|------|------|------|
| id | UUID | 主鍵 |
| code | 字串 | 分類代碼（唯一） |
| name | 字串 | 分類名稱 |
| icon | 字串 | 圖標（選填） |
| sortOrder | 整數 | 排序順序（預設 0） |
| isActive | 布林 | 是否啟用（預設 true） |
| createdAt | 時間 | 建立時間 |
| updatedAt | 時間 | 更新時間 |

---

## 業務邏輯

### 店鋪分類

| 代碼 | 名稱 | 說明 |
|------|------|------|
| FOOD | 食 | 餐飲、食品 |
| CLOTHING | 衣 | 服飾、配件 |
| HOUSING | 住 | 房屋、家居 |
| TRANSPORT | 行 | 交通、汽車 |
| EDUCATION | 育樂 | 教育、娛樂 |
| HEALTH | 大健康 | 醫療、保健 |
| OTHER | 其他 | 其他類別 |

### 營業時間格式

| 欄位 | 類型 | 說明 |
|------|------|------|
| monday | 物件/null | 週一營業時間 |
| tuesday | 物件/null | 週二營業時間 |
| wednesday | 物件/null | 週三營業時間 |
| thursday | 物件/null | 週四營業時間 |
| friday | 物件/null | 週五營業時間 |
| saturday | 物件/null | 週六營業時間 |
| sunday | 物件/null | 週日營業時間 |

**每日營業時間格式：**

| 欄位 | 類型 | 說明 |
|------|------|------|
| open | 字串 | 開店時間（如 "09:00"） |
| close | 字串 | 關店時間（如 "18:00"） |
| isClosed | 布林 | 是否公休 |

### 店鋪建立規則

| 規則 | 說明 |
|------|------|
| 1 | 只有商務會員可以建立店鋪 |
| 2 | 一個會員只能有一個店鋪 |
| 3 | 店鋪必須填寫名稱和分類 |
| 4 | 地址可選填，但建議填寫以便地圖顯示 |

### 公益商家顯示規則

| 條件 | 說明 |
|------|------|
| 1 | 店鋪 isActive = true |
| 2 | 店鋪 isPublic = true |
| 3 | 會員狀態為 ACTIVE |
| 4 | 會員類型為 BUSINESS（商務會員） |

### 附近商家查詢

| 項目 | 說明 |
|------|------|
| 計算方式 | 使用 Haversine 公式計算距離 |
| 預設搜尋半徑 | 10 公里 |

---

## DTO 資料格式

### 店鋪列表查詢

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| keyword | 字串 | 否 | 搜尋關鍵字 |
| categoryId | 字串 | 否 | 分類 ID |
| city | 字串 | 否 | 城市 |
| latitude | 浮點數 | 否 | 目前緯度 |
| longitude | 浮點數 | 否 | 目前經度 |
| radius | 整數 | 否 | 搜尋半徑（公里） |
| page | 整數 | 否 | 頁碼 |
| limit | 整數 | 否 | 每頁數量 |

### 建立/更新店鋪

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| name | 字串 | 是 | 店鋪名稱 |
| categoryId | 字串 | 是 | 分類 ID |
| slogan | 字串 | 否 | 宣傳標語 |
| description | 字串 | 否 | 店鋪介紹 |
| phone | 字串 | 否 | 聯絡電話 |
| email | 字串 | 否 | 聯絡郵箱 |
| address | 字串 | 否 | 完整地址 |
| city | 字串 | 否 | 城市 |
| district | 字串 | 否 | 區域 |
| latitude | 浮點數 | 否 | 緯度 |
| longitude | 浮點數 | 否 | 經度 |
| businessHours | 物件 | 否 | 營業時間 |
| discount | 字串 | 否 | 優惠政策 |
| isPublic | 布林 | 否 | 是否公開顯示 |

### 更新店鋪圖片

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| coverImage | 字串 | 否 | 封面圖片 URL |
| images | 字串陣列 | 否 | 店鋪圖片 URL 列表 |

### 店鋪詳情回應

| 欄位 | 類型 | 說明 |
|------|------|------|
| id | 字串 | 店鋪 ID |
| name | 字串 | 店鋪名稱 |
| category.id | 字串 | 分類 ID |
| category.name | 字串 | 分類名稱 |
| category.icon | 字串 | 分類圖標 |
| slogan | 字串/null | 宣傳標語 |
| description | 字串/null | 店鋪介紹 |
| phone | 字串/null | 聯絡電話 |
| email | 字串/null | 聯絡郵箱 |
| address | 字串/null | 完整地址 |
| city | 字串/null | 城市 |
| district | 字串/null | 區域 |
| latitude | 浮點數/null | 緯度 |
| longitude | 浮點數/null | 經度 |
| businessHours | 物件/null | 營業時間 |
| discount | 字串/null | 優惠政策 |
| coverImage | 字串/null | 封面圖片 |
| images | 字串陣列 | 店鋪圖片 |
| viewCount | 整數 | 瀏覽次數 |
| member.id | 字串 | 店主會員 ID |
| member.name | 字串 | 店主姓名 |
| member.avatar | 字串 | 店主頭像 |
| distance | 浮點數 | 距離（公里，選填） |

### 附近商家查詢

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| latitude | 浮點數 | 是 | 目前緯度 |
| longitude | 浮點數 | 是 | 目前經度 |
| radius | 整數 | 否 | 半徑（預設 10 公里） |
| categoryId | 字串 | 否 | 分類篩選 |
| limit | 整數 | 否 | 數量限制 |

---

## 圖片規格

| 類型 | 尺寸建議 | 格式 | 大小限制 |
|------|----------|------|----------|
| 封面圖片 | 1200 x 600 | JPG/PNG | 2MB |
| 店鋪圖片 | 800 x 800 | JPG/PNG | 1MB |
| 圖片數量 | 最多 9 張 | - | - |

---

## 錯誤代碼

| 代碼 | 說明 |
|------|------|
| SHP_001 | 店鋪不存在 |
| SHP_002 | 無權限編輯此店鋪 |
| SHP_003 | 已有店鋪，無法重複建立 |
| SHP_004 | 非商務會員，無法建立店鋪 |
| SHP_005 | 分類不存在 |
| SHP_006 | 圖片數量超過限制 |
| SHP_007 | 店鋪已停用 |

---

## 相關模組

- [Member 會員系統](./member.md) - 店鋪擁有者
- [Point 點數系統](./point.md) - 店鋪收款
